<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Generator Prompt Gambar Gemini</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f1f5f9; /* slate-100 */
        }
        .form-select, .form-input {
            background-color: white;
            border-color: #cbd5e1; /* slate-300 */
        }
        .form-select:focus, .form-input:focus {
            outline: none;
            border-color: #0ea5e9; /* sky-500 */
            box-shadow: 0 0 0 2px #bae6fd; /* sky-200 */
        }
        .btn-primary {
            background-color: #0ea5e9; /* sky-500 */
            color: white;
            transition: background-color 0.3s;
        }
        .btn-primary:hover {
            background-color: #0284c7; /* sky-600 */
        }
        .btn-secondary {
            background-color: #475569; /* slate-600 */
            color: white;
            transition: background-color: 0.3s;
        }
        .btn-secondary:hover {
            background-color: #334155; /* slate-700 */
        }
        .loader {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #0ea5e9;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        .modal-overlay {
            transition: opacity 0.3s ease;
        }
        .modal-content {
            transition: transform 0.3s ease;
        }
    </style>
</head>
<body class="text-slate-800">

    <div class="container mx-auto px-4 py-8 md:py-12 max-w-4xl">
        <header class="text-center mb-10">
            <h1 class="text-4xl font-extrabold text-slate-900 mb-2">Generator Prompt Gambar AI</h1>
            <p class="text-lg text-slate-600">Buat prompt yang sempurna untuk model AI teks-ke-gambar Anda menggunakan kekuatan Gemini.</p>
        </header>

        <main class="bg-white p-6 md:p-8 rounded-2xl shadow-lg border border-slate-200">
            
            <div class="mb-6">
                <div class="flex justify-between items-center mb-2">
                    <label for="apiKey" class="block text-sm font-bold text-slate-700">Kunci API Gemini Anda</label>
                    <button id="howToGetApiKeyBtn" class="text-xs font-semibold text-sky-600 hover:text-sky-800 transition-colors">(Bagaimana cara mendapatkannya?)</button>
                </div>
                <input type="password" id="apiKey" class="form-input w-full px-3 py-2 rounded-lg border focus:ring-2" placeholder="Masukkan kunci API Anda di sini...">
                <p class="text-xs text-slate-500 mt-1">Kunci API Anda hanya digunakan di browser Anda dan tidak pernah disimpan.</p>
            </div>

            <div class="space-y-6 mb-6">
                <div>
                    <label for="idea" class="block text-sm font-bold text-slate-700 mb-2">1. Masukkan Ide Dasar Anda</label>
                    <textarea id="idea" rows="4" class="form-input w-full px-3 py-2 rounded-lg border focus:ring-2" placeholder="Contoh: seekor naga di perpustakaan kuno"></textarea>
                </div>
                
                <div>
                    <label for="aspectRatio" class="block text-sm font-bold text-slate-700 mb-2">2. Pilih Format/Rasio Aspek</label>
                    <select id="aspectRatio" class="form-select w-full px-3 py-2 rounded-lg border focus:ring-2">
                        <option value="Persegi 1:1 (cocok untuk feed Instagram)">Persegi 1:1 (Feed Instagram)</option>
                        <option value="Lanskap 16:9 (cocok untuk YouTube, X/Twitter)">Lanskap 16:9 (YouTube, X/Twitter)</option>
                        <option value="Lanskap 4:3 (cocok untuk presentasi)">Lanskap 4:3 (Presentasi)</option>
                        <option value="Potret 9:16 (cocok untuk Stories, Reels, TikTok)">Potret 9:16 (Stories, Reels, TikTok)</option>
                        <option value="Potret 4:5 (cocok untuk feed Instagram)">Potret 4:5 (Feed Instagram)</option>
                    </select>
                </div>

                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <label class="block text-sm font-bold text-slate-700 md:col-span-2">3. Tentukan Detail Visual (Pilih atau Ketik Sendiri)</label>
                    <div>
                        <select id="style" class="form-select w-full px-3 py-2 rounded-lg border focus:ring-2 mb-2">
                            <option value="Fotorealistis">Gaya: Fotorealistis</option>
                            <option value="Lukisan Cat Minyak">Gaya: Lukisan Cat Minyak</option>
                            <option value="Seni Digital">Gaya: Seni Digital</option>
                            <option value="Gaya Anime/Manga">Gaya: Anime/Manga</option>
                            <option value="Seni Piksel">Gaya: Seni Piksel</option>
                            <option value="Fantasi">Gaya: Fantasi</option>
                            <option value="Fiksi Ilmiah">Gaya: Fiksi Ilmiah</option>
                        </select>
                        <input type="text" id="customStyle" class="form-input w-full px-3 py-2 rounded-lg border focus:ring-2" placeholder="Atau ketik gaya sendiri...">
                    </div>
                    <div>
                        <select id="composition" class="form-select w-full px-3 py-2 rounded-lg border focus:ring-2 mb-2">
                            <option value="Close-up">Komposisi: Close-up</option>
                            <option value="Medium shot">Komposisi: Medium shot</option>
                            <option value="Foto jarak jauh (Wide shot)">Komposisi: Wide shot</option>
                            <option value="Dilihat dari bawah (Low angle)">Komposisi: Low angle</option>
                            <option value="Dilihat dari atas (High angle)">Komposisi: High angle</option>
                        </select>
                        <input type="text" id="customComposition" class="form-input w-full px-3 py-2 rounded-lg border focus:ring-2" placeholder="Atau ketik komposisi sendiri...">
                    </div>
                    <div class="md:col-span-2">
                        <select id="lighting" class="form-select w-full px-3 py-2 rounded-lg border focus:ring-2 mb-2">
                            <option value="Cahaya golden hour">Pencahayaan: Golden hour</option>
                            <option value="Pencahayaan dramatis">Pencahayaan: Dramatis</option>
                            <option value="Cahaya lembut dan menyebar">Pencahayaan: Lembut & menyebar</option>
                            <option value="Neon">Pencahayaan: Neon</option>
                            <option value="Cahaya bulan">Pencahayaan: Cahaya bulan</option>
                            <option value="Sinematik">Pencahayaan: Sinematik</option>
                        </select>
                        <input type="text" id="customLighting" class="form-input w-full px-3 py-2 rounded-lg border focus:ring-2" placeholder="Atau ketik pencahayaan sendiri...">
                    </div>
                </div>
            </div>

            <div class="text-center mb-8">
                <button id="generateBtn" class="btn-primary font-bold py-3 px-8 rounded-full text-lg shadow-md hover:shadow-lg transition-shadow">
                    Buat Prompt!
                </button>
            </div>

            <div id="resultContainer" class="hidden">
                <h2 class="text-2xl font-bold text-slate-800 mb-4 text-center">Prompt Anda yang Telah Disempurnakan</h2>
                <div id="loader" class="loader mx-auto my-4 hidden"></div>
                <div id="errorMessage" class="bg-rose-100 border-l-4 border-rose-500 text-rose-700 p-4 rounded-r-lg hidden mb-4"></div>
                <div id="promptOutput" class="bg-slate-50 p-6 rounded-lg border border-slate-200 relative">
                    <p id="promptText" class="text-slate-700 leading-relaxed"></p>
                    <button id="copyBtn" class="btn-secondary absolute top-3 right-3 py-1 px-3 text-xs font-semibold rounded-md">Salin</button>
                </div>
            </div>

        </main>
        <footer class="text-center mt-8 text-sm text-slate-500">
            <p>Ditenagai oleh Google Gemini. Dibuat dengan ❤️.</p>
        </footer>
    </div>
    
    <!-- Modal untuk petunjuk API Key -->
    <div id="apiKeyModal" class="modal-overlay fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50 hidden opacity-0">
        <div class="modal-content bg-white rounded-lg shadow-xl p-6 md:p-8 max-w-lg w-full transform scale-95">
            <h3 class="text-xl font-bold text-slate-900 mb-4">Cara Mendapatkan Kunci API Gemini</h3>
            <ol class="list-decimal list-inside space-y-3 text-slate-700">
                <li>Buka <a href="https://aistudio.google.com/app/apikey" target="_blank" rel="noopener noreferrer" class="text-sky-600 font-semibold underline">Google AI Studio</a> di tab baru.</li>
                <li>Masuk menggunakan Akun Google Anda.</li>
                <li>Klik tombol "<strong>Create API key</strong>".</li>
                <li>Pilih "<strong>Create API key in new project</strong>".</li>
                <li>Salin (copy) kunci yang baru dibuat.</li>
                <li>Tempel (paste) kunci tersebut ke dalam kolom input di halaman ini.</li>
            </ol>
            <div class="text-right mt-6">
                <button id="closeModalBtn" class="btn-primary font-semibold py-2 px-5 rounded-lg">Mengerti</button>
            </div>
        </div>
    </div>


    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const generateBtn = document.getElementById('generateBtn');
            const resultContainer = document.getElementById('resultContainer');
            const promptOutput = document.getElementById('promptOutput');
            const promptText = document.getElementById('promptText');
            const copyBtn = document.getElementById('copyBtn');
            const loader = document.getElementById('loader');
            const errorMessage = document.getElementById('errorMessage');
            
            // Modal elements
            const apiKeyModal = document.getElementById('apiKeyModal');
            const howToGetApiKeyBtn = document.getElementById('howToGetApiKeyBtn');
            const closeModalBtn = document.getElementById('closeModalBtn');
            const modalContent = document.querySelector('.modal-content');

            // Show modal
            howToGetApiKeyBtn.addEventListener('click', () => {
                apiKeyModal.classList.remove('hidden');
                setTimeout(() => {
                    apiKeyModal.classList.remove('opacity-0');
                    modalContent.classList.remove('scale-95');
                }, 10);
            });

            // Hide modal
            function hideModal() {
                apiKeyModal.classList.add('opacity-0');
                modalContent.classList.add('scale-95');
                setTimeout(() => {
                    apiKeyModal.classList.add('hidden');
                }, 300);
            }

            closeModalBtn.addEventListener('click', hideModal);
            apiKeyModal.addEventListener('click', (e) => {
                if (e.target === apiKeyModal) {
                    hideModal();
                }
            });


            generateBtn.addEventListener('click', async () => {
                const apiKey = document.getElementById('apiKey').value.trim();
                const idea = document.getElementById('idea').value.trim();
                const aspectRatio = document.getElementById('aspectRatio').value;

                // Logic to prioritize custom input over dropdown selection
                const customStyle = document.getElementById('customStyle').value.trim();
                const style = customStyle || document.getElementById('style').value;
                
                const customComposition = document.getElementById('customComposition').value.trim();
                const composition = customComposition || document.getElementById('composition').value;

                const customLighting = document.getElementById('customLighting').value.trim();
                const lighting = customLighting || document.getElementById('lighting').value;

                if (!apiKey) {
                    showError("Harap masukkan kunci API Gemini Anda.");
                    return;
                }
                if (!idea) {
                    showError("Harap masukkan ide dasar Anda.");
                    return;
                }

                resultContainer.classList.remove('hidden');
                promptOutput.classList.add('hidden');
                errorMessage.classList.add('hidden');
                loader.classList.remove('hidden');

                const metaPrompt = `You are an expert prompt engineer for text-to-image AI models. Your task is to expand a user's basic idea into a rich, detailed, and evocative prompt.
                
                User's basic idea: "${idea}"
                Selected visual style: "${style}"
                Selected composition: "${composition}"
                Selected lighting: "${lighting}"
                Desired aspect ratio/format: "${aspectRatio}"

                Combine these elements into a single, cohesive paragraph. The prompt should be descriptive, focusing on visual details, mood, and atmosphere that are appropriate for the specified format. Do not add any introductory text, concluding remarks, or explanations. Only output the final, single-paragraph prompt itself.`;
                
                try {
                    const chatHistory = [{ role: "user", parts: [{ text: metaPrompt }] }];
                    const payload = { contents: chatHistory };
                    const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${apiKey}`;

                    const response = await fetch(apiUrl, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(payload)
                    });

                    if (!response.ok) {
                        const errorData = await response.json();
                        throw new Error(errorData.error?.message || `HTTP error! status: ${response.status}`);
                    }

                    const result = await response.json();
                    
                    if (result.candidates && result.candidates.length > 0 &&
                        result.candidates[0].content && result.candidates[0].content.parts &&
                        result.candidates[0].content.parts.length > 0) {
                        const generatedText = result.candidates[0].content.parts[0].text;
                        promptText.textContent = generatedText;
                        promptOutput.classList.remove('hidden');
                    } else {
                        throw new Error("Respons API tidak valid atau kosong.");
                    }

                } catch (error) {
                    showError(`Terjadi kesalahan: ${error.message}`);
                } finally {
                    loader.classList.add('hidden');
                }
            });

            copyBtn.addEventListener('click', () => {
                const textToCopy = promptText.textContent;
                // Using the deprecated execCommand for broader compatibility in sandboxed environments.
                const textArea = document.createElement('textarea');
                textArea.value = textToCopy;
                document.body.appendChild(textArea);
                textArea.select();
                try {
                    document.execCommand('copy');
                    copyBtn.textContent = 'Tersalin!';
                    setTimeout(() => {
                        copyBtn.textContent = 'Salin';
                    }, 2000);
                } catch (err) {
                    console.error('Gagal menyalin teks: ', err);
                    showError("Gagal menyalin teks. Silakan salin secara manual.");
                }
                document.body.removeChild(textArea);
            });

            function showError(message) {
                errorMessage.textContent = message;
                errorMessage.classList.remove('hidden');
                resultContainer.classList.remove('hidden');
                loader.classList.add('hidden');
                promptOutput.classList.add('hidden');
            }
        });
    </script>
</body>
</html>
